{"version":3,"file":"regrafx.js","sources":["../../src/composite/composite-vertex.js","../../src/abstract-scheduler.ts","../../src/schedulers/debounce.ts","../../src/search/dfs.js","../../src/tasks/tasks.js","../../src/token.js","../../src/message.js","../../src/subscription.js","../../src/subscribers.js","../../src/observable.js","../../src/observer.js","../../src/schedulers/scheduler.ts","../../src/tools.js","../../src/task.js","../../src/schedulers/throttle.ts","../../src/vertex.js","../../src/operators/combine-latest.js","../../src/regrafx.js"],"sourcesContent":["export class CompositeVertex {\n  constructor() {\n  }\n  to(vertex) {return this.output.to(vertex);}\n  err(vertex) {return this.output.err(vertex);}\n  final(vertex) {return this.output.final(vertex);}\n  subscribe(fn) {return this.output.subscribe(fn);}\n  trigger(...input) {return this.input.trigger(...input);}\n  input(vertex) {this.input = vertex;}\n  output(vertex) {this.output = vertex;}\n  $observer() {return this.input.$observer();}\n}","export abstract class AbstractScheduler{\n  protected $$delay: number;\n  constructor(delay: number = 0){\n    this.$$delay = delay;\n  }\n  protected abstract schedule() : Promise<any>;\n}\n\nexport interface IPausable{\n  isRunning(): boolean;\n}\n","import { AbstractScheduler} from '../abstract-scheduler'\n\nexport class Debounce extends AbstractScheduler{\n  private $$timerId: any;\n  constructor(delay: number = 0) {\n    super(delay);\n    this.$$timerId = null;\n  }\n  public schedule() : Promise<any>{\n    return new Promise<any>( resolve  => {\n      if (this.$$timerId) {\n        clearTimeout(this.$$timerId);\n      }\n      this.$$timerId = setTimeout(() => {\n        this.$$timerId = null;\n        resolve();\n      }, this.$$delay);\n    });\n  }\n}\n","export function dfs(vertex) {\n  const visited = [];\n  visit(vertex.$$observer);\n  return visited;\n  function visit(obs, d = 0, edge = 'origin') {\n    const boundVertex = obs._fn.boundVertex;\n\n    visited.push({ vertex: boundVertex, edge: edge, depth: d });\n\n    for (const obr of boundVertex.$$thenObservers.observers().iterable()) {\n      if (visited.map(x => x.vertex).indexOf(obr._fn.boundVertex) === -1) { visit(obr, d + 1, 'to'); }\n    }\n    for (const obr of boundVertex.$$catchObservers.observers().iterable()) {\n      if (visited.map(x => x.vertex).indexOf(obr._fn.boundVertex) === -1) { visit(obr, d + 1, 'err'); }\n    }\n    for (const obr of boundVertex.$$finallyObservers.observers().iterable()) {\n      if (visited.map(x => x.vertex).indexOf(obr._fn.boundVertex) === -1) { visit(obr, d + 1, 'final'); }\n    }\n  }\n}\n\n// TODO: use template method\nexport function dfsGraph(vertex) {\n  const visited = [];\n  const elements = [];\n  visit(vertex.$$observer);\n  return elements;\n  function visit(obs, d = 0, edge = 'origin') {\n    const boundVertex = obs._fn.boundVertex;\n    visited.push({ vertex: boundVertex, edge: edge, depth: d });\n    elements.push({ data: { id: boundVertex.$$name } });\n    for (const obr of boundVertex.$$thenObservers.observers().iterable()) {\n      if (visited.map(x => x.vertex).indexOf(obr._fn.boundVertex) === -1) {\n        visit(obr, d + 1, 'to');\n      }\n      elements.push({ data: { id: (obs._fn.boundVertex.$$name + obr._fn.boundVertex.$$name), source: obs._fn.boundVertex.$$name, target: obr._fn.boundVertex.$$name } });\n    }\n    for (const obr of boundVertex.$$catchObservers.observers().iterable()) {\n      if (visited.map(x => x.vertex).indexOf(obr._fn.boundVertex) === -1) {\n        visit(obr, d + 1, 'err');\n      }\n      elements.push({ data: { id: (obs._fn.boundVertex.$$name + obr._fn.boundVertex.$$name), source: obs._fn.boundVertex.$$name, target: obr._fn.boundVertex.$$name }, style: { 'line-color': '#d90000', 'target-arrow-color': '#d90000', } });\n    }\n    for (const obr of boundVertex.$$finallyObservers.observers().iterable()) {\n      if (visited.map(x => x.vertex).indexOf(obr._fn.boundVertex) === -1) {\n        visit(obr, d + 1, 'final');\n      }\n      elements.push({ data: { id: (obs._fn.boundVertex.$$name + obr._fn.boundVertex.$$name), source: obs._fn.boundVertex.$$name, target: obr._fn.boundVertex.$$name } });\n    }\n  }\n}\n","export const identity = x => x;\nexport const noop = () => undefined;\n","export class Token {\n  constructor() {\n    this.$$symbol = Symbol();\n    this.$$date = Date.now();\n    this.$$cancelled = false;\n  }\n  cancel() {\n    this.$$cancelled = true;\n  }\n}","import { Token } from './token';\n\nexport class Message {\n  constructor(origin) {\n    this.$$origin = origin;\n    this.$$date = Date.now();\n    this.$$token = new Token();\n    this.$$subject = null;\n    this.$$signatures = [];\n  }\n  subject(subject) { this.$$subject = subject; return this; }\n  sign(signature) { this.$$signatures.push(signature); return this; }\n  token() {return this.$$token;}\n  lastSigner() {return this.$$signatures[this.$$signatures.length - 1];}\n}\n\nMessage.$$name = 'ReGraFX.Message';\n","export class Subscription {\n  constructor(obj) {\n    this.id = Symbol();\n    this.unsubscribe = obj.unsubscribe.bind(obj, this.id);\n  }\n}","import { Subscription } from './subscription.js';\n\nexport class Subscribers {\n  constructor() {\n    this._subscribers = {};\n  }\n  subscribe(obj) {\n    const subscription = new Subscription(this);\n    this._subscribers[subscription.id] = obj;\n    return subscription;\n  }\n  unsubscribe(id) {\n    delete this._subscribers[id];\n  }\n  size() {\n    return this.ids().length;\n  }\n  ids() {\n    return Object.getOwnPropertySymbols(this._subscribers);\n  }\n  get(id) {\n    return this._subscribers[id];\n  }\n  set(obj) {\n    this._subscribers[id] = obj;\n  }\n  iterable() {\n    return Object.getOwnPropertySymbols(this._subscribers).map(s => this._subscribers[s]);\n  }\n}","import {Subscribers} from './subscribers.js';\n\nexport class Observable {\n  constructor(subscribers = new Subscribers() ) {\n    this.$$observers = subscribers;\n  }\n  subscribe(observer) {\n    return this.observers().subscribe(observer);\n  }\n  observers() {\n    return this.$$observers;\n  }\n  unsubscribe(id) {\n    this.observers().unsubscribe(id);\n  }\n  notify(...obj) {\n    for (const observer of this.observers().iterable()) {\n      observer.next(...obj);\n    }\n  }\n}\n","\nexport class Observer {\n  constructor(fn = () => undefined) {\n    this._fn = fn;\n  }\n  next(...input) {\n    return this._fn(...input);\n  }\n}\n","import { AbstractScheduler } from '../abstract-scheduler';\nimport { IPausable } from '../abstract-scheduler';\nimport { Observable } from '../observable';\n\nexport class Scheduler extends AbstractScheduler implements IPausable {\n  private $$pause: boolean;\n  private $$pauser: Observable;\n  constructor(delay: number = 0, pauser: Observable = new Observable()) {\n    super(delay);\n    this.$$pause = false;\n    this.$$pauser = pauser;\n  }\n  schedule() {\n    return new Promise(resolve => {\n      setTimeout(() => {\n        this.isRunning()\n          ? resolve()\n          : this.$$pauser.subscribe((pause: boolean) => {\n            this.$$pause = pause;\n            if (this.isRunning()) { resolve(); }\n          });\n      }, this.$$delay);\n    });\n  }\n  isRunning() {\n    return !this.$$pause;\n  }\n}\n","export function isFunction(value) {\n  return typeof value === 'function' || false;\n}\n\nexport function isPromise(p) {\n  return p && isFunction(p.then);\n}\n\nexport function isMessage(obj) {\n  return (obj && obj.$$name && obj.$$name === 'ReGraFX.Message');\n}\n","import { isPromise } from './tools';\nimport { noop } from './tasks/tasks';\n\nexport class Task {\n  constructor(fn = noop) {\n    this.$$fn = fn;\n  }\n  execute(...input) {\n    try {\n      const res = this.$$fn(...input);\n      return isPromise(res) ? res : Promise.resolve(res);\n    } catch (err) {\n      return Promise.reject(err);\n    }\n  }\n}\n","import { AbstractScheduler} from '../abstract-scheduler'\n\nexport class Throttle extends AbstractScheduler {\n  private $$timerId: any;\n  constructor(delay: number = 0) {\n    super(delay);\n    this.$$timerId = null;\n  }\n  public schedule() {\n    return new Promise<any>((resolve, reject) => {\n      if (this.$$timerId) {\n        reject();\n      }\n      else {\n        this.$$timerId = setTimeout(() => {\n          this.$$timerId = null;\n        },\n          this.$$delay);\n        resolve();\n      }\n    });\n  }\n}\n","import { Observable } from './observable.js';\nimport { Observer } from './observer.js';\nimport { Scheduler } from './schedulers/scheduler';\nimport { Message } from './message.js';\nimport { Task } from './task.js';\nexport class Vertex {\n  constructor(task = new Task(), scheduler = new Scheduler(), name = 'Vertex') {\n    this.$$id = Symbol(name);\n    this.$$task = task;\n    this.$$scheduler = scheduler;\n    this.$$name = name;\n\n    this.$$thenObservers = new Observable();\n    this.$$catchObservers = new Observable();\n    this.$$finallyObservers = new Observable();\n    this.$$observable = new Observable();\n\n    const boundVertexFn = this.$$next.bind(this);\n    boundVertexFn.boundVertex = this;\n    this.$$observer = new Observer(boundVertexFn);\n  }\n  $observer() {return this.$$observer;}\n  to(vertex) {\n    this.$$thenObservers.subscribe(vertex.$observer());\n    return this;\n  }\n  err(vertex) {\n    this.$$catchObservers.subscribe(vertex.$observer());\n    return this;\n  }\n  final(vertex) {\n    this.$$finallyObservers.subscribe(vertex.$observer());\n    return this;\n  }\n\n  subscribe(fn) {\n    this.$$observable.subscribe(new Observer(fn));\n  }\n\n  trigger(...input) {\n    const msg = new Message(this.$$id);\n    input.push(msg);\n    this.$$observer.next(...input);\n    return msg;\n  }\n  $$next(...input) {\n    const msg = input[input.length - 1];\n    if (!msg.token().$$cancelled) {\n      this.$$scheduler.schedule()\n        .then(() => {\n          const promise = this.$$task.execute(...input);\n          promise\n            .then(out => {\n              msg.sign(this.$$id);\n              this.$$thenObservers.notify(out, msg);\n            })\n            .catch(err => {\n              msg.sign(this.$$id);\n              this.$$catchObservers.notify(err, msg);\n            })\n            .finally(() => {\n              this.$$finallyObservers.notify(null, msg);\n            });\n          this.$$observable.notify(promise);\n        });\n    }\n  }\n}\n","import { Task } from '../task';\n\nexport class CombineLatest extends Task {\n  constructor(...vertices) {\n    super();\n    this.$$fn = this.fn;\n    this.$$vertices = vertices.map(v => v.$$id);\n    this.$$combined = [];\n    this.$$length = this.$$vertices.length;\n    this.$$sum = 0;\n    this.$$expectSum = this.$$length * (this.$$length + 1) / 2;\n  }\n\n  fn(input, message) {\n    const id = message.lastSigner();\n    const index = this.$$vertices.indexOf(id);\n    if (index !== -1) {\n      if (this.$$sum < this.$$expectSum) { this.$$sum += (index + 1); }\n      this.$$combined[index] = input;\n    }\n    return (this.$$sum === this.$$expectSum) ?\n      Promise.resolve(this.$$combined)\n      :\n      Promise.reject(this.$$combined);\n  }\n}\n","/* REactive GRAph FluX ReGraFX */\n\nimport { CompositeVertex } from './composite/composite-vertex';\nimport { Debounce } from './schedulers/debounce';\nimport { dfs, dfsGraph } from './search/dfs';\nimport { identity } from './tasks/tasks';\nimport { Message } from './message';\nimport { noop } from './tasks/tasks';\nimport { Observable } from './observable';\nimport { Observer } from './observer';\nimport { Scheduler } from './schedulers/scheduler';\nimport { Task } from './task';\nimport { Throttle } from './schedulers/throttle';\nimport { Vertex } from './vertex';\nimport { CombineLatest } from './operators/combine-latest';\n\nconst Search = {\n  dfs: dfs,\n  dfsGraph: dfsGraph\n};\n\nexport {\n  CompositeVertex,\n  Debounce,\n  identity,\n  Message,\n  noop,\n  Observable,\n  Observer,\n  Scheduler,\n  Search,\n  Task,\n  Throttle,\n  Vertex,\n  CombineLatest\n};\n"],"names":["CompositeVertex","vertex","output","to","err","final","fn","subscribe","input","trigger","$observer","AbstractScheduler","delay","$$delay","Debounce","$$timerId","Promise","resolve","clearTimeout","setTimeout","dfs","visited","visit","$$observer","obs","d","edge","boundVertex","_fn","push","depth","$$thenObservers","observers","iterable","obr","map","x","indexOf","$$catchObservers","$$finallyObservers","dfsGraph","elements","data","id","$$name","source","target","style","identity","noop","undefined","Token","$$symbol","Symbol","$$date","Date","now","$$cancelled","Message","origin","$$origin","$$token","$$subject","$$signatures","subject","signature","length","Subscription","obj","unsubscribe","bind","Subscribers","_subscribers","subscription","ids","Object","getOwnPropertySymbols","s","Observable","subscribers","$$observers","observer","next","Observer","Scheduler","pauser","$$pause","$$pauser","isRunning","pause","isFunction","value","isPromise","p","then","Task","$$fn","res","reject","Throttle","Vertex","task","scheduler","name","$$id","$$task","$$scheduler","$$observable","boundVertexFn","$$next","msg","token","schedule","promise","execute","out","sign","notify","catch","finally","CombineLatest","vertices","$$vertices","v","$$combined","$$length","$$sum","$$expectSum","message","lastSigner","index","Search"],"mappings":"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"}